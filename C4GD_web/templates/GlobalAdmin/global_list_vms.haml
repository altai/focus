-extends "GlobalAdmin/base.haml"
-block requirejs
  %script
    |var default_columns = {{ columns.default_names.__repr__()|safe }};
  %script data-main="{{ url_for('static', filename='js/global_list_vms.js') }}" src="{{ url_for('static', filename='js/require.js') }}" 
-block content
  %section
    %div.btn-toolbar
      %div.btn-group#columns-controller
        %button class="btn {% if columns.is_changed %}restore-columns{% endif %}"
          %b.icon-edit
          -if columns.is_changed
            Reset
          -else
            Columns
        %button.btn.dropdown-toggle data-toggle="dropdown" href="#"    
          %span.caret
        %ul.dropdown-menu.columns-selection
          -for c in columns.selected:
            %li.selected-column
              %a rel="{{ c.attr_name }}"
                %b.icon-ok
                =c.verbose_name
          %li.divider
          -for c in columns.spare:
            %li.spare-column
              %a rel="{{ c.attr_name }}" -> =c.verbose_name
      %div.btn-group#dump-controller
        %button.btn.export-json
          %b.icon-download-alt
          JSON
        %button.btn.dropdown-toggle data-toggle="dropdown" href="#"
          %span.caret
        %ul.dropdown-menu
          %li
            %a.export-csv
              CSV
          %li
            %a.export-xml
              XML
    %table.table.table-striped.table-bordered.table-condensed
      %thead
        %tr
          -for column in columns.selected:
            %th id="sorting-controller-{{ column.attr_name }}" class="sorting-contoller{% if column.sorted == 'asc' %} asc{% elif column.sorted == 'desc'%} desc{% endif %}"
              %div.btn-group
                =column.verbose_name
                -if column.sorted == 'asc'
                  %b.icon-chevron-up
                -elif column.sorted == 'desc'
                  %b.icon-chevron-down
                -else
                  %b.icon-random
                %a.dropdown-toggle data-toggle="dropdown" href="#"
                  %span.caret
                %ul.dropdown-menu
                  -if column.sorted == 'asc'
                    %li
                      %a.desc
                        %b.icon-chevron-down
                    %li
                      %a                          
                        %b.icon-random                  
                  -elif column.sorted == 'desc'
                    %li
                      %a.asc
                        %b.icon-chevron-up
                    %li
                      %a                          
                        %b.icon-random                  
                  -else
                    %li
                      %a.asc
                        %b.icon-chevron-up
                    %li
                      %a.desc                      
                        %b.icon-chevron-down        
      %tbody
        -for row in data:
          %tr
            -for cell in row:
              %td -> =cell
  
    %div.pagination
      %ul
        -if pagination.has_prev
          %li
            %a href="{{ url_for_other_page(pagination.page - 1) }}" -> Prev
        -for page in pagination.iter_pages()
          %li class="{% if page == pagination.page %}active{% endif %}"
            %a href="{{ url_for_other_page(page) }}" -> {{ page }}
        -if pagination.has_next
          %li
            %a href="{{ url_for_other_page(pagination.page + 1) }}" -> Next

          